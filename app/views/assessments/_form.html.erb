
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
</style>
<table class="tg">
<thead>
  <tr>
    <th class="tg-0pky" colspan="4">Name of Pupil</th>
    <th class="tg-0lax">Mid Term</th>
    <th class="tg-0lax">Class Work</th>
    <th class="tg-0lax">Class Test</th>
    <th class="tg-0lax">Project</th>
    <th class="tg-0lax">Exam</th>
  </tr>
</thead>
<tbody>
<span class="span-sub-heading" style="text-align: center; font-size: 24px;">
  Assessment for <span style="color: red;"><%= @subject_name %></span>

</span>
<h4><%= link_to 'Go Back',root_path,class: 'btn btn-primary' %></h4>

<tr>
<%= simple_form_for(@assessment, remote: true) do |f| %>
  <%= f.label :term ,"Select Term", style: 'margin-left: 30px; color:blue;' %>
  <%= f.select :term, [['Term 1', 1], ['Term 2', 2], ['Term 3', 3]], {}, { class: 'form-control custom-select', id: 'assessment_term', style: 'width: 150px; margin-left: 30px;' } %>

  
  <% @students.each do |student| %>
    <tr>
    <td class="tg-0lax" colspan="4" style="display: none;"><%= student.id %></td>
    <td class="tg-0lax" colspan="4"><%= "#{student.first_name} #{student.last_name}" %></td>
    <td class="tg-0lax"><input type="number" name="test1"></td>
    <td class="tg-0lax">
    <input type="number" name="group_work" id="group_work_input" max="10" oninput="checkInput(this)">
  </td>
      <td class="tg-0lax"><input type="number" name="test_2"  max="10" oninput="checkInput(this)"></td>
    <td class="tg-0lax"><input type="number" name="project"  max="10" oninput="checkInput(this)"></td>
    <td class="tg-0lax"><input type="number" name="exam"  ></td>
    </tr>
  <% end %>

  <tr>
  <td colspan="9" style="text-align: center;">
  <%= f.input :subject_id, as: :hidden, input_html: { value: @subject_master_id }, class: 'form-control', id: 'subject_id' %>
  <%= f.hidden_field :user_id, value: current_user.id, class: 'form-control', id: 'user_id' %>
  

    <%= f.button :submit, "Submit", class: "btn btn-danger",id: "submit-button" %>
  </td>
</tr>
<% end %>
</tr>

</tbody>
</table>




<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>

  function submitForm() {
    let marks = [];
    let term = $('#assessment_term').val();
    let userId = $('#user_id').val();
    let subjectId = $('#assessment_subject_id').val();

    $('table').find('tr').each(function(index, row) {
      let mark = {};
      mark.student_id = $(row).find('td:eq(0)').text().trim();
      mark.name = $(row).find('td:eq(1)').text().trim();
      mark.test1 = $(row).find("[name='test1']").val();
      mark.group_work = $(row).find("[name='group_work']").val();
      mark.test_2 = $(row).find("[name='test_2']").val();
      mark.project = $(row).find("[name='project']").val();
      mark.exam = $(row).find("[name='exam']").val();

      marks.push(mark);
    });

    $.ajax({
      type: 'POST',
      url: '/create_ajax', 
      data: { 
        marks: marks,
        term: term,
        user_id: userId,
        subject_id: subjectId
      },
      success: function(response) {
        // Handle success response
        console.log(response);
        // Show SweetAlert on success
        Swal.fire({
          icon: 'success',
          title: 'Assessment saved successfully!',
          showConfirmButton: false,
          timer: 1500
        });
      },
      error: function(xhr, status, error) {
        // Handle error if needed
        console.error(xhr, status, error);
        // Show SweetAlert on error
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'Something went wrong! Please try again.',
          showConfirmButton: false,
          timer: 1500
        });
      }
    });
  }

  $(document).ready(function() {
    $('#submit-button').on('click', function(e) {
      e.preventDefault();
      submitForm();
    });
  });
</script>


<script>
  function checkInput(input) {
    if (input.value > 10) {
      input.value = 10; // Set the value to 10 if it exceeds 10
    }
  }
</script>