<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/timer.jquery/0.7.0/timer.jquery.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>  
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css'> </link> 
<style>

        <style>
        #resume{
            display: none
        }

        .boxTimer{
                border: 8px solid brown;
    border-radius: 36px;
    width: 100px;
    height: 100px;
    display: none
        }

        #timer1{
                text-align: center;
    margin-top: 34%;
    font-size: 20px;
    overflow-wrap: break-word;
    font-weight: 900;
}
        }
        </style>

<div class="boxTimer">
<div id="timer1">  </div>
</div>


      <div class="content-wrapper">
  <div class="row">

    <div class="col-lg-12 d-flex grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-between">
                      <h4 class="card-title mb-3"> Lesson Title:  <%=@lessons[0].title %></h4>
                      <div class="boxTimer">
<div id="timer1">  </div>
</div>
                    </div>

                    <div class="table-responsive">
                      <table class="table">
                       <thead>
  <tr>
   
      <th>Objectives</th>
  <th>Content/Subject Matter</th>
       <th>Time Spent Teaching</th>
      
            <th></th>
  
    </tr>
  </thead>

  <tbody>
    <% @lessons.each do |lesson| %>
      <tr>
      
        <td><%= lesson.objectives %></td>
          <td><%= lesson.procedures %></td>
           <td><%= lesson.duration_after_teaching %></td>
        
        <td> 
         <% if lesson.status == true%>
          <button class= "btn btn-secondary" disabled><s>Teaching Ended </s></button>
      
          <% else%>
           <button class= "btn btn-warning bb" id="bbb" onclick='submiForm(<%= lesson.id %>,<%= lesson.subject_id %> )'>Start Teaching</button>
      
          <% end%>
        </td>

        <td> 

      

       <!-- <button class= "btn btn-danger" data-toggle="modal" data-target="#myModal4">View Lesson Notes</button>  -->

        </td>

  
               <% if lesson.avafile.attached? %>
                        <td class='"btn btn-warning"' style="display: none">
                          <%= link_to "View Lesson Note", rails_blob_path(lesson.avafile, disposition: :preview),{ :class => "btn btn-primary",:id => "linka" } %>

                    
                        </td>
                 <% end%>   
    

         <td>    <%= link_to 'Record Activity / Assessment', record_activity_path(:id=>lesson.id,:subject_id => @subject_id),{:remote => true, class:'btn btn-primary','data-toggle' =>  "modal",'data-target' => '#myModal1','data-backdrop'=> "static", 'data-keyboard'=>"false"} %></td>
     
  
      </tr>
    <% end %>
  </tbody>
</table>
     </div>
                  </div>
                </div>
              </div>
            </div>
          </div>



      <!--  <iframe src = "/ViewerJS/#../rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDRG9JYTJWNVNTSWRORFJPY0RrM1lXb3phRnBNYmxjNFpERnpUVlJNTWxsQ0Jqb0dSVlE2RUdScGMzQnZjMmwwYVc5dVNTSkJhVzVzYVc1bE95Qm1hV3hsYm1GdFpUMGlhWEp2ZVdGc2N5NXdaR1lpT3lCbWFXeGxibUZ0WlNvOVZWUkdMVGduSjJseWIzbGhiSE11Y0dSbUJqc0dWRG9SWTI5dWRHVnVkRjkwZVhCbFNTSVVZWEJ3YkdsallYUnBiMjR2Y0dSbUJqc0dWQT09IiwiZXhwIjoiMjAyMi0wOS0yNlQxNToxMDo1Mi4yNjdaIiwicHVyIjoiYmxvYl9rZXkifX0=--4dc42b149dcbff0565a2f17c6c606cbaa7ea144d/iroyals.pdf?content_type=application%2Fpdf&disposition=inline%3B+filename%3D%22iroyals.pdf%22%3B+filename%2A%3DUTF-8%27%27iroyals.pdf" width='800' height='700' allowfullscreen webkitallowfullscreen></iframe> -->

     
       <!--    <iframe src="http://localhost:3000/test.pdf" width='700' height='700' allowfullscreen webkitallowfullscreen></iframe>   
  #view=fitH 
       <iframe id="myIframe" width='700' height='700' allowfullscreen webkitallowfullscreen></iframe>   -->

<div id="myModal1" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content" >
              <div class="modal-header">
                <h4 class="modal-title"> Record Activity</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>
              <div class="modal-body" id = 'fi'>
                <%#= render "record_activity" %>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
          </div>
         </div>
       </div>


<div id="myModal4" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content" >
            <!--  <div class="modal-header">
                <h4 class="modal-title"> Lesson Notes</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>
             
               <iframe id="myIframe" width='700' height='700' allowfullscreen webkitallowfullscreen></iframe>    -->
          
            <!--   <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div> -->
          </div>
         </div>
       </div>



      


     
        

<script>

$(document).ready(function () {
 

    var fie = document.getElementById("linka");
    let myIframe = document.getElementById("myIframe") ;
 
   console.log(`Linka is ---- ${fie}`);
    myIframe.src = fie;

})

  function submiForm(id,subj_id) {
    console.log("clicking", id)
    var lesson_id = id
    var subj_id = subj_id
    var btnEl = document.getElementById("bbb").innerHTML 
    var disBtn = document.getElementById("bbb")
    console.log('btnEl',btnEl)

    // var btnRes = document.getElementById("res").innerHTML

      if (btnEl == 'Start Teaching'){
          $("#timer1").timer();
          $(".bb").html('Stop Teaching').removeClass('btn btn-warning').addClass('btn btn-danger')
           $('.boxTimer').show();
      } 

      else
      {
        $(".bb").html('<s>Teaching Ended</s>').removeClass('btn btn-danger').addClass('btn btn-warning')
        $('#timer1').timer('pause');
         $('.boxTimer').hide();

         disBtn.disabled = true;
         var timerVal = document.getElementById("timer1").innerHTML 

         console.log("TIMER VALUE",timerVal )
         showTestAlert(lesson_id,subj_id);
         
           $.ajax({
               type: 'POST',
                url: '/update_teaching',
                dataType: "script",
                data: {
                          lesson_id: lesson_id,
                          teaching_time: timerVal,
                          teaching_staus: true,
                          time_lesson_ended: new Date().toISOString().slice(0, 19).replace('T', ' '),
                      },
     
        success: function(data){
            // handle your success here
            console.log(data);
        }
    });




 

      }


          
  }


      function showTestAlert(id,subj_id){

            swal({   title: "Teaching Activity Ended",   
            text: "You have succesfully ended your lesson for the day" + "\n",  
            confirmButtonColor: "#DD6B55",   
            confirmButtonText: "Close",     
            closeOnConfirm: false,   
            closeOnCancel: false }).then((result) => {
  console.log(result)
    if (result) {
      window.location.href = "/teaching?id="+id+"&subject_id="+subj_id;
    }
  });

            
    }
  </script>



  